<div class="header-title">
  Profil utilisateur
</div>

<div *ngIf="loading">Chargement en cours...</div>
<div *ngIf="error">Erreur lors du chargement des informations utilisateur.</div>

<form (ngSubmit)="updateProfile()" #f="ngForm" class="profile-form">

  <div class="form-group">
    <input
      id="email"
      type="email"
      [(ngModel)]="email"
      name="email"
      required
      #emailCtrl="ngModel"
      placeholder="Email"
      pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
    />
    <div class="error" *ngIf="emailCtrl.invalid && emailCtrl.touched">
      <small *ngIf="emailCtrl.errors?.['required']">Email requis.</small>
      <small *ngIf="emailCtrl.errors?.['pattern'] || emailCtrl.errors?.['email']">Email invalide.</small>
    </div>
  </div>

  <div class="form-group">
    <input
      id="username"
      type="text"
      [(ngModel)]="username"
      name="username"
      required
      minlength="3"
      #usernameCtrl="ngModel"
      placeholder="Nom d'utilisateur"
    />
    <div class="error" *ngIf="usernameCtrl.invalid && usernameCtrl.touched">
      <small *ngIf="usernameCtrl.errors?.['required']">Nom requis.</small>
      <small *ngIf="usernameCtrl.errors?.['minlength']">Minimum 3 caractères.</small>
    </div>
  </div>

  <div class="form-group">
    <input
      id="password"
      type="password"
      [(ngModel)]="password"
      name="password"
      required
      pattern="^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9]).{8,}$"
      #passCtrl="ngModel"
      placeholder="••••••••"
    />
    <div class="error" *ngIf="passCtrl.invalid && passCtrl.touched">
      <small *ngIf="passCtrl.errors?.['required']">Mot de passe requis.</small>
      <small *ngIf="passCtrl.errors?.['pattern']">
        Doit contenir majuscule, minuscule, chiffre et caractère spécial.
      </small>
    </div>
  </div>

  <button type="submit" [disabled]="f.invalid">Sauvegarder</button>

  <div *ngIf="successMessage" class="message success">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="message error">{{ errorMessage }}</div>
</form>

<hr>

<label class="section-label">Abonnements</label>

<div *ngIf="subscribedThemes.length > 0; else noSubs" class="themes-container">
  <mat-card *ngFor="let theme of subscribedThemes" class="theme-card">
    <mat-card-header>
      <mat-card-title>{{ theme.name }}</mat-card-title>
      <mat-card-subtitle class="header-info">
        Abonné : Oui
      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <p>{{ theme.description }}</p>
    </mat-card-content>
    <mat-card-actions>
      <button 
        class="unsubscribe-button subscribed" 
        (click)="toggleSubscription(theme)">
        Se désabonner
      </button>
    </mat-card-actions>
  </mat-card>
</div>

<ng-template #noSubs>
  <p>Aucun abonnement actuellement.</p>
</ng-template>